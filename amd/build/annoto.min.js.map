{"version":3,"sources":["../src/annoto.js"],"names":["define","$","log","notification","Ajax","window","moodleAnnoto","sessionStorage","getItem","console","err","init","courseid","pageurl","modid","info","call","methodname","args","done","response","params","JSON","parse","error","isGlobalScope","isACLmatch","hasAnnotoTag","setupKaltura","document","ready","findPlayer","bind","fail","exception","maKApp","kApp","setupKalturaKdpMap","kdpMap","length","h5p","first","get","youtube","vimeo","videojs","jwplayer","annotoplayer","playerType","youtubeSrc","src","search","id","defaultPlayerId","playerId","bootstrap","bootsrapDone","require","bootstrapUrl","bootWidget","horizontalAlign","widgetOverlay","indexOf","config","clientId","position","features","tabs","featureTab","cta","featureCTA","width","max","align","vertical","alignVertical","horizontal","ux","ssoAuthRequestHandle","location","replace","loginUrl","zIndex","widgets","player","type","element","mediaDetails","title","mediaTitle","description","mediaDescription","group","mediaGroupId","mediaGroupTitle","privateThread","timeline","overlayVideo","demoMode","rtl","locale","Annoto","on","annotoReady","requirejs","vjs","boot","warn","api","jwt","userToken","auth","catch","kdpMapKey","hasOwnProperty","setupKalturaKdp","kdp","setupDone","doneCb","kBind","setupKalturaPlugin","widget","playerConfig","enrichMediaDetails","details","retVal"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * javscript for component 'local_annoto'.\n *\n * @package    local_annoto\n * @copyright  Annoto Ltd.\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n  'jquery',\n  'core/log',\n  'core/notification',\n  'core/ajax',\n], function($, log, notification, Ajax) {\n\n    window.moodleAnnoto = window.moodleAnnoto || {};\n\n    try {\n        if (window.sessionStorage.getItem('moodleAnnotoDebug')) {\n            log = console;\n        }\n    } catch(err) {}\n\n    return {\n        init: function(courseid, pageurl, modid) {\n            log.info('AnnotoMoodle: plugin init');\n            Ajax.call([{\n                methodname: 'get_jsparams',\n                args: {\n                    courseid: courseid,\n                    pageurl: pageurl,\n                    modid: modid\n                },\n                done: function(response) {\n                    var params = JSON.parse(response);\n                    this.params = params;\n                    if (!params) {\n                        log.error('AnnotoMoodle: empty params. Plugin won`t start.');\n                        return;\n                    }\n\n                    // Return if plugin works in Global scope or is present in ACL or has <annoto> tag - continue this script.\n                    if (!this.params.isGlobalScope) {\n                        if (!(this.params.isACLmatch || this.hasAnnotoTag())) {\n                            log.info('AnnotoMoodle: plugin is disabled for this page.');\n                            return;\n                        }\n                    }\n\n                    this.setupKaltura();\n                    $( document ).ready(this.findPlayer.bind(this));\n\n                }.bind(this),\n                fail: notification.exception\n            }]);\n        },\n        setupKaltura: function() {\n            var maKApp = window.moodleAnnoto.kApp;\n            window.moodleAnnoto.setupKalturaKdpMap = this.setupKalturaKdpMap.bind(this);\n\n            if (maKApp) {\n                log.info('AnnotoMoodle: Kaltura loaded on init');\n                this.setupKalturaKdpMap(maKApp.kdpMap);\n            } else {\n                log.info('AnnotoMoodle: Kaltura not loaded on init');\n            }\n        },\n        hasAnnotoTag: function() {\n            return ($('annoto').length > 0 && $('annotodisable').length === 0);\n        },\n        findPlayer: function() {\n            log.info('AnnotoMoodle: detecting player');\n            var h5p = $('iframe.h5p-iframe').first().get(0),\n                youtube = $('iframe[src*=\"youtube.com\"]').first().get(0),\n                vimeo = $('iframe[src*=\"vimeo.com\"]').first().get(0),\n                videojs = $('.video-js').first().get(0),\n                jwplayer = $('.jwplayer').first().get(0),\n                annotoplayer = '';\n\n            if (videojs) {\n                annotoplayer = videojs;\n                this.params.playerType = 'videojs';\n            } else if (jwplayer) {\n                annotoplayer = jwplayer;\n                this.params.playerType = 'jw';\n            } else if (h5p) {\n                annotoplayer = h5p;\n                this.params.playerType = 'h5p';\n            } else if (youtube) {\n                var youtubeSrc = youtube.src;\n                if (youtubeSrc.search(/enablejsapi/i) === -1) {\n                    youtube.src = (youtubeSrc.search(/[?]/) === -1) ? youtubeSrc + '?enablejsapi=1' : youtubeSrc + '&enablejsapi=1';\n                }\n                annotoplayer = youtube;\n                this.params.playerType = 'youtube';\n            } else if (vimeo) {\n                annotoplayer = vimeo;\n                this.params.playerType = 'vimeo';\n            } else {\n                return;\n            }\n            if (!annotoplayer.id || annotoplayer.id === '') {\n                annotoplayer.id = this.params.defaultPlayerId;\n            }\n\n            this.params.playerId = annotoplayer.id;\n\n            this.bootstrap();\n            log.info('AnnotoMoodle: detected ' + this.params.playerType + ':' + this.params.playerId);\n        },\n        bootstrap: function() {\n            if (this.bootsrapDone) {\n                return;\n            }\n            this.bootsrapDone = true;\n            require([this.params.bootstrapUrl], this.bootWidget.bind(this));\n        },\n        bootWidget: function() {\n            var params = this.params;\n            var nonOverlayTimelinePlayers = ['youtube', 'vimeo'];\n            var innerAlignPlayers = ['h5p'];\n            var horizontalAlign = 'element_edge';\n            if (!params.widgetOverlay || params.widgetOverlay === 'auto') {\n                horizontalAlign = (innerAlignPlayers.indexOf(params.playerType) !== -1) ? 'inner' : 'element_edge';\n            } else if (params.widgetOverlay === 'inner') {\n                horizontalAlign = 'inner';\n            }\n            var config = {\n                clientId: params.clientId,\n                position: params.position,\n                features: {\n                    tabs: params.featureTab,\n                    cta: params.featureCTA,\n                },\n                width: {\n                    max: (horizontalAlign === 'inner') ? 320 : 360,\n                },\n                align: {\n                    vertical: params.alignVertical,\n                    horizontal: horizontalAlign,\n                },\n                ux: {\n                    ssoAuthRequestHandle: function() {\n                        window.location.replace(params.loginUrl);\n                    },\n                },\n                zIndex: params.zIndex ? params.zIndex : 100,\n                widgets: [{\n                    player: {\n                        type: params.playerType,\n                        element: params.playerId,\n                        mediaDetails: function() {\n                            return {\n                                title: params.mediaTitle,\n                                description: params.mediaDescription,\n                                group: {\n                                    id: params.mediaGroupId,\n                                    type: 'playlist',\n                                    title: params.mediaGroupTitle,\n                                    privateThread: params.privateThread,\n                                }\n                            };\n                        },\n                    },\n                    timeline: {\n                        overlayVideo: (nonOverlayTimelinePlayers.indexOf(params.playerType) === -1),\n                    },\n                }],\n                demoMode: params.demoMode,\n                rtl: params.rtl,\n                locale: params.locale,\n            };\n\n            if (window.Annoto) {\n                window.Annoto.on('ready', this.annotoReady.bind(this));\n                if (params.playerType === 'videojs' && window.requirejs) {\n                    window.require(['media_videojs/video-lazy'], function(vjs) {\n                        config.widgets[0].player.params = {\n                            videojs: vjs\n                        };\n                        window.Annoto.boot(config);\n                    });\n                } else {\n                    window.Annoto.boot(config);\n                }\n            } else {\n                log.warn('AnnotoMoodle: bootstrap didn`t load');\n            }\n        },\n\n        annotoReady: function(api) {\n            // Api is the API to be used after Annoot is setup\n            // It can be used for SSO auth.\n            var jwt = this.params.userToken;\n            log.info('AnnotoMoodle: annoto ready');\n            if (api && jwt && jwt !== '') {\n                api.auth(jwt).catch(function() {\n                    log.error('AnnotoMoodle: SSO auth error');\n                });\n            } else {\n                log.info('AnnotoMoodle: SSO auth skipped');\n            }\n        },\n\n        setupKalturaKdpMap: function(kdpMap) {\n            if (!kdpMap) {\n                log.info('AnnotoMoodle: skip setup Kaltura players - missing map');\n                return;\n            }\n            log.info('AnnotoMoodle: setup Kaltura players');\n            for (var kdpMapKey in kdpMap) {\n                if (kdpMap.hasOwnProperty(kdpMapKey)) {\n                    this.setupKalturaKdp(kdpMap[kdpMapKey]);\n                }\n            }\n        },\n        setupKalturaKdp: function(kdp) {\n            if (!kdp.config || kdp.setupDone || !kdp.doneCb) {\n                log.info('AnnotoMoodle: skip Kaltura player: ' + kdp.id);\n                return;\n            }\n            log.info('AnnotoMoodle: setup Kaltura player: ' + kdp.id);\n            kdp.setupDone = true;\n            kdp.player.kBind('annotoPluginReady', this.annotoReady.bind(this));\n            this.setupKalturaPlugin(kdp.config);\n            kdp.doneCb();\n        },\n        setupKalturaPlugin: function(config) {\n            /*\n             * config will contain the annoto widget configuration.\n             * This hook provides a chance to modify the configuration if required.\n             * Below we use this chance to attach the ssoAuthRequestHandle and mediaDetails hooks.\n             * https://github.com/Annoto/widget-api/blob/master/lib/config.d.ts#L128\n             *\n             * NOTICE: config is already setup by the Kaltura Annoto plugin,\n             * so we need only to override the required configuration, such as\n             * clientId, features, etc. DO NOT CHANGE THE PLAYER TYPE OR PLAYER ELEMENT CONFIG.\n            */\n            var params = this.params;\n            var widget = config.widgets[0];\n            var playerConfig = widget.player;\n            var ux = config.ux || {};\n            var align = config.align || {};\n            var features = config.features || {};\n\n            config.ux = ux;\n            config.align = align;\n            config.features = features;\n\n            config.clientId = params.clientId;\n            config.position = params.position;\n            config.demoMode = params.demoMode;\n            config.locale = params.locale;\n            config.rtl = params.rtl;\n\n            features.tabs = params.featureTab;\n            features.cta = params.featureCTA;\n            align.vertical = params.alignVertical;\n            ux.ssoAuthRequestHandle = function() {\n                window.location.replace(params.loginUrl);\n            };\n            playerConfig.mediaDetails = this.enrichMediaDetails.bind(this);\n        },\n\n        enrichMediaDetails: function(details) {\n            // The details contains MediaDetails the plugin has managed to obtain\n            // This hook gives a change to enrich the details, for example\n            // providing group information for private discussions per course/playlist\n            // https://github.com/Annoto/widget-api/blob/master/lib/media-details.d.ts#L6.\n            // Annoto Kaltura plugin, already has some details about the media like title.\n            //\n            var params = this.params;\n            var retVal = details || {};\n\n            retVal.title = retVal.title || params.mediaTitle;\n            retVal.description = retVal.description ? retVal.description : params.mediaDescription;\n            retVal.group = {\n                id: params.mediaGroupId,\n                type: 'playlist',\n                title: params.mediaGroupTitle,\n                privateThread: params.privateThread,\n            };\n\n            return retVal;\n        },\n    };\n});\n"],"file":"annoto.min.js"}