{"version":3,"sources":["../src/annoto.js"],"names":["define","$","log","notification","Ajax","VimeoPlayer","videoJsPlayer","window","moodleAnnoto","sessionStorage","getItem","console","err","init","courseid","modid","document","find","get","info","call","methodname","args","done","response","result","warn","params","JSON","parse","hasAnnotoTag","tilesInit","icontent","setupKaltura","setupWistiaIframeEmbed","checkVimeoTime","ready","bootstrap","bind","fail","exception","maKApp","kApp","setupKalturaKdpMap","kdpMap","length","findPlayer","container","parent","body","h5p","first","youtube","vimeo","videojs","jwplayer","wistia","html5","playerElement","playerType","youtubeSrc","src","search","id","Math","random","toString","substr","playerId","element","bootsrapDone","findMultiplePlayers","annotoPlayer","require","bootstrapUrl","bootWidget","prepareConfig","config","widgets","player","type","timeline","overlay","indexOf","backend","domain","deploymentDomain","demoMode","clientId","hooks","mediaDetails","details","title","mediaTitle","description","mediaDescription","outcomes","isExpected","ssoAuthRequestHandle","location","replace","loginUrl","group","mediaGroupId","mediaGroupTitle","mediaGroupDescription","locale","Annoto","on","annotoReady","requirejs","self","vjs","boot","api","annotoAPI","jwt","userToken","auth","catch","error","checkWidgetVisibility","authKalturaPlayer","kdpMapKey","hasOwnProperty","setupKalturaKdp","kdp","setupDone","doneCb","kBind","setupKalturaPlugin","getPageUrl","href","enrichMediaDetails","mediaParams","retVal","courseFormat","M","tabtopics","format_grid","format_topcoll","snapTheme","reloadAnnoto","mutationList","mutationTarget","filter","m","target","classList","contains","destroy","then","offsetParent","load","observerNodeTargets","querySelectorAll","Object","values","grid","topcoll","tabs","snap","modtab","join","observerConfig","attributes","childList","subtree","observer","MutationObserver","forEach","observe","wistiaplayers","desiredParam","name","value","iframe","iframeSrc","URL","targetParam","searchParams","host","match","setupWistiaIframeEmbedPlugin","AnnotoIframeApi","annoto","Client","onSetup","next","onReady","token","isVimeoTime","getElementById","setupRetry","isReady","vimeoPlayer","querySelector","setTimeout","attributeName","isloaded","tiles","wrapper","idIcontentPages","addEventListener","event","matches","vimeos","allPlayers","multiplePlayers","activePlayerId","validatePlayerId","reloadAnnotoWidget","players","playerJs","entries"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * javscript for component 'local_annoto'.\n *\n * @package\n * @copyright  Annoto Ltd.\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\n  'jquery',\n  'core/log',\n  'core/notification',\n  'core/ajax',\n  'https://player.vimeo.com/api/player.js',\n  'https://vjs.zencdn.net/7.20.1/video.min.js',\n], function($, log, notification, Ajax, VimeoPlayer, videoJsPlayer) {\n\n    window.moodleAnnoto = window.moodleAnnoto || {};\n\n    try {\n        if (window.sessionStorage.getItem('moodleAnnotoDebug')) {\n            log = console;\n        }\n    } catch (err) {}\n\n    return {\n        init: function(courseid, modid) {\n\n            // if page is 'edit settings' then return\n            if ($(document).find('body#page-mod-page-mod').get(0)){\n                return;\n            }\n\n            log.info('AnnotoMoodle: plugin init');\n            Ajax.call([{\n                methodname: 'get_jsparams',\n                args: {\n                    courseid: courseid,\n                    modid: modid\n                },\n                done: function(response) {\n                    if (!response.result) {\n                        log.warn('AnnotoMoodle: action not permitted for user');\n                        return;\n                    }\n                    this.params = JSON.parse(response.params);\n\n                    // Return if has <annoto> tag.\n                    if (this.hasAnnotoTag()) {\n                        log.info('AnnotoMoodle: plugin is disabled for this page using the Atto plugin.');\n                        return;\n                    }\n\n                    this.tilesInit();\n                    this.icontent();\n                    this.setupKaltura();\n                    this.setupWistiaIframeEmbed();\n                    this.checkVimeoTime();\n                    $(document).ready(this.bootstrap.bind(this));\n\n                }.bind(this),\n                fail: notification.exception\n            }]);\n\n        },\n        setupKaltura: function() {\n            const maKApp = window.moodleAnnoto.kApp;\n            window.moodleAnnoto.setupKalturaKdpMap = this.setupKalturaKdpMap.bind(this);\n\n            if (maKApp) {\n                log.info('AnnotoMoodle: Kaltura loaded on init');\n                this.setupKalturaKdpMap(maKApp.kdpMap);\n            } else {\n                log.info('AnnotoMoodle: Kaltura not loaded on init');\n            }\n        },\n        hasAnnotoTag: function() {\n            return ($('annoto').length > 0 && $('annotodisable').length === 0);\n        },\n        findPlayer: function(container) {\n            log.info('AnnotoMoodle: detecting player');\n            const parent = container || document.body,\n                h5p = $(parent).find('iframe.h5p-iframe').first().get(0),\n                youtube = $(parent).find('iframe[src*=\"youtube.com\"]').first().get(0),\n                vimeo = $(parent).find('iframe[src*=\"vimeo.com\"]').first().get(0),\n                videojs = $(parent).find('.video-js').first().get(0),\n                jwplayer = $(parent).find('.jwplayer').first().get(0),\n                wistia = $(parent).find('.wistia_embed').first().get(0),\n                html5 = $(parent).find('video').first().get(0);\n            let playerElement = null;\n\n            if (videojs) {\n                playerElement = videojs;\n                this.params.playerType = 'videojs';\n            } else if (jwplayer) {\n                playerElement = jwplayer;\n                this.params.playerType = 'jw';\n            } else if (h5p) {\n                playerElement = h5p;\n                this.params.playerType = 'h5p';\n            } else if (youtube) {\n                const youtubeSrc = youtube.src;\n                if (youtubeSrc.search(/enablejsapi/i) === -1) {\n                    youtube.src = (youtubeSrc.search(/[?]/) === -1) ? youtubeSrc + '?enablejsapi=1' : youtubeSrc + '&enablejsapi=1';\n                }\n                playerElement = youtube;\n                this.params.playerType = 'youtube';\n            } else if (vimeo) {\n                playerElement = vimeo;\n                this.params.playerType = 'vimeo';\n            } else if (wistia) {\n                playerElement = wistia;\n                this.params.playerType = 'wistia';\n            } else if (html5) {\n                playerElement = html5;\n                this.params.playerType = 'html5';\n            } else {\n                log.info('AnnotoMoodle: no player was founded');\n                return;\n            }\n            if (!playerElement.id || playerElement.id === '') {\n                playerElement.id = 'annoto_player_id_' + Math.random().toString(36).substr(2, 6);\n            }\n            this.params.playerId = `#${playerElement.id}`;\n            this.params.element = playerElement;\n\n            return playerElement;\n        },\n        bootstrap: function() {\n            if (this.bootsrapDone) {\n                return;\n            }\n            // Check if we have multiple players\n            this.findMultiplePlayers();\n            let annotoPlayer = this.findPlayer.call(this);\n            if (annotoPlayer) {\n                this.bootsrapDone = true;\n                require([this.params.bootstrapUrl], this.bootWidget.bind(this));\n                log.info(`AnnotoMoodle: detected ${this.params.playerType} : ${this.params.playerId}`);\n            }\n        },\n        prepareConfig: function() {\n            const config = this.config,\n                params = this.params,\n                nonOverlayTimelinePlayers = ['youtube', 'vimeo'];\n\n            config.widgets[0].player.type = params.playerType;\n            config.widgets[0].player.element = params.playerId;\n            config.widgets[0].timeline = {\n                overlay: (nonOverlayTimelinePlayers.indexOf(params.playerType) === -1),\n            };\n        },\n        bootWidget: function() {\n            const params = this.params;\n            const config = {\n                backend: {\n                  domain: params.deploymentDomain\n                },\n                demoMode: false,\n                clientId: params.clientId,\n                widgets: [{player: {}}],\n                hooks: {\n                    mediaDetails: function() {\n                        return {\n                            details: {\n                                title: params.mediaTitle,\n                                description: params.mediaDescription,\n                            },\n                            outcomes: {\n                                isExpected: true\n                            }\n                        };\n                    },\n                    ssoAuthRequestHandle: function() {\n                        window.location.replace(params.loginUrl);\n                    },\n                },\n                group: {\n                    id: params.mediaGroupId,\n                    title: params.mediaGroupTitle,\n                    description: params.mediaGroupDescription,\n                },\n                ... (params.locale) && {locale: params.locale},\n            };\n\n            this.config = config;\n\n            this.prepareConfig.call(this);\n\n            if (window.Annoto) {\n                window.Annoto.on('ready', this.annotoReady.bind(this));\n                if (this.params.playerType === 'videojs' && window.requirejs) {\n                    const self = this;\n                    window.require(['media_videojs/video-lazy'], function(vjs) {\n                        self.config.widgets[0].player.params = {\n                            videojs: vjs\n                        };\n                        window.Annoto.boot(self.config);\n                    });\n                } else {\n                    window.Annoto.boot(this.config);\n                }\n\n            } else {\n                log.warn('AnnotoMoodle: bootstrap didn`t load');\n            }\n        },\n\n        annotoReady: function(api) {\n            // Api is the API to be used after Annoot is setup\n            // It can be used for SSO auth.\n            this.annotoAPI = api;\n            const jwt = this.params.userToken;\n            log.info('AnnotoMoodle: annoto ready');\n            if (api && jwt && jwt !== '') {\n                api.auth(jwt).catch(function() {\n                    log.error('AnnotoMoodle: SSO auth error');\n                });\n                this.checkWidgetVisibility();\n            } else {\n                log.info('AnnotoMoodle: SSO auth skipped');\n            }\n        },\n\n        authKalturaPlayer: function(api) {\n            // Api is the API to be used after Annoot is setup\n            // It can be used for SSO auth.\n            const jwt = this.params.userToken;\n            log.info('AnnotoMoodle: annoto ready');\n            if (api && jwt && jwt !== '') {\n                api.auth(jwt).catch(function() {\n                    log.error('AnnotoMoodle: SSO auth error');\n                });\n            } else {\n                log.info('AnnotoMoodle: SSO auth skipped');\n            }\n        },\n\n        setupKalturaKdpMap: function(kdpMap) {\n            if (!kdpMap) {\n                log.info('AnnotoMoodle: skip setup Kaltura players - missing map');\n                return;\n            }\n            log.info('AnnotoMoodle: setup Kaltura players');\n            for (let kdpMapKey in kdpMap) {\n                if (kdpMap.hasOwnProperty(kdpMapKey)) {\n                    this.setupKalturaKdp(kdpMap[kdpMapKey]);\n                }\n            }\n        },\n        setupKalturaKdp: function(kdp) {\n            if (!kdp.config || kdp.setupDone || !kdp.doneCb) {\n                log.info('AnnotoMoodle: skip Kaltura player: ' + kdp.id);\n                return;\n            }\n            log.info('AnnotoMoodle: setup Kaltura player: ' + kdp.id);\n            kdp.setupDone = true;\n            kdp.player.kBind('annotoPluginReady', this.authKalturaPlayer.bind(this));\n            this.setupKalturaPlugin(kdp.config);\n            kdp.doneCb();\n        },\n        setupKalturaPlugin: function(config) {\n            /*\n             * Config will contain the annoto widget configuration.\n             * This hook provides a chance to modify the configuration if required.\n             * Below we use this chance to attach the ssoAuthRequestHandle and mediaDetails hooks.\n             * https://github.com/Annoto/widget-api/blob/master/lib/config.d.ts#L128\n             *\n             * NOTICE: config is already setup by the Kaltura Annoto plugin,\n             * so we need only to override the required configuration, such as\n             * clientId, features, etc. DO NOT CHANGE THE PLAYER TYPE OR PLAYER ELEMENT CONFIG.\n            */\n            const params = this.params;\n\n            config.clientId = params.clientId;\n            config.hooks = {\n                getPageUrl: function() {\n                    return window.location.href;\n                },\n                ssoAuthRequestHandle: function() {\n                    window.location.replace(params.loginUrl);\n                },\n                mediaDetails: this.enrichMediaDetails.bind(this),\n            };\n            config.group = {\n                id: params.mediaGroupId,\n                title: params.mediaGroupTitle,\n                description: params.mediaGroupDescription,\n            };\n            if (params.locale) {\n                config.locale = params.locale;\n            }\n        },\n\n        enrichMediaDetails: function(mediaParams) {\n            // The details contains MediaDetails the plugin has managed to obtain\n            // This hook gives a change to enrich the details, for example\n            // providing group information for private discussions per course/playlist\n            // https://github.com/Annoto/widget-api/blob/master/lib/media-details.d.ts#L6.\n            // Annoto Kaltura plugin, already has some details about the media like title.\n            //\n            const retVal = (mediaParams && mediaParams.details) || {};\n\n            retVal.title = retVal.title || this.params.mediaTitle;\n            retVal.description = retVal.description || this.params.mediaDescription;\n\n            return retVal;\n        },\n\n        checkWidgetVisibility: function() {\n            const formatSelectors = {\n                grid: 'body.format-grid .grid_section, body.format-grid #gridshadebox',\n                topcoll: 'body.format-topcoll .ctopics.topics .toggledsection ',\n                tabs: 'body.format-tabtopics .yui3-tab-panel',\n                snap: 'body.format-topics.theme-snap .topics .section.main',\n                modtab: '#page-mod-tab-view .TabbedPanelsContentGroup .TabbedPanelsContent'\n            };\n            let courseFormat = '',\n                playerElement = this.params.element,\n                self = this;\n\n            if (typeof M.tabtopics !== 'undefined') {\n                courseFormat = 'tabs';\n            } else if (typeof M.format_grid !== 'undefined') {\n                courseFormat = 'grid';\n            } else if (typeof M.format_topcoll !== 'undefined') {\n                    courseFormat = 'topcoll';\n            } else if (typeof M.snapTheme !== 'undefined') {\n                courseFormat = 'snap';\n            } else if (document.body.id === 'page-mod-tab-view') {\n                courseFormat = 'modtab';\n            }\n\n            const reloadAnnoto = function(mutationList) {\n                let mutationTarget = null;\n\n                if (mutationList) {\n                      switch (courseFormat) {\n                      case 'tabs':\n                        mutationTarget = mutationList.filter(function(m) {\n                          return m.target.classList.contains('yui3-tab-panel-selected');\n                        })[0].target;\n                        break;\n                      case 'grid':\n                        mutationTarget = mutationList.filter(function(m) {\n                          return !m.target.classList.contains('hide_section');\n                        })[0].target;\n                        break;\n                      case 'topcoll':\n                        mutationTarget = mutationList[0].target;\n                        break;\n                      case 'snap':\n                        mutationTarget = mutationList.filter(function(m) {\n                          return m.target.classList.contains('state-visible');\n                        })[0].target;\n                        break;\n                      case 'modtab':\n                        mutationTarget = mutationList.filter(function(m) {\n                          return m.target.classList.contains('TabbedPanelsContentVisible');\n                        })[0].target;\n                        break;\n                    }\n                }\n\n                playerElement = self.findPlayer(mutationTarget);\n                if (playerElement) {\n                    self.params.element = playerElement;\n                    self.prepareConfig();\n                }\n\n                self.annotoAPI.destroy().then(function() {\n                    if (playerElement.offsetParent) {\n                        self.annotoAPI.load(self.config);\n                    }\n                });\n              };\n\n            const observerNodeTargets = document.querySelectorAll(Object.values(formatSelectors).join(', '));\n\n            if (observerNodeTargets.length > 0) {\n                const observerConfig = {attributes: true, childList: true, subtree: false},\n                    observer = new MutationObserver(reloadAnnoto);\n\n                observerNodeTargets.forEach(function(target) {\n                    observer.observe(target, observerConfig);\n                });\n\n                if (playerElement.offsetParent === null) {\n                    reloadAnnoto();\n                }\n            }\n\n        },\n\n        setupWistiaIframeEmbed: function() {\n            const wistiaplayers = document.querySelectorAll('iframe');\n            const annotoIframeClient = \"https://cdn.annoto.net/widget-iframe-api/latest/client.js\";\n            const targetHost = 'fast.wistia.net';\n            const desiredParam = {\n                name: 'plugin[annoto][src]',\n                value: 'cdn.annoto.net'\n            };\n\n            wistiaplayers.forEach((iframe) => {\n                let iframeSrc;\n                try {\n                    iframeSrc = new URL(iframe.src);\n                } catch (err) {\n                    return;\n                }\n                const targetParam = iframeSrc.searchParams.get(desiredParam.name);\n                if (iframeSrc.host !== targetHost) {\n                    return;\n                }\n\n                if (targetParam && targetParam.match(desiredParam.value)) {\n                    require([annotoIframeClient], this.setupWistiaIframeEmbedPlugin.bind(this, iframe));\n                    return;\n                }\n            });\n        },\n\n        setupWistiaIframeEmbedPlugin: function(iframe, AnnotoIframeApi) {\n            const params = this.params,\n                annoto = new AnnotoIframeApi.Client(iframe);\n\n            annoto.onSetup(function(next) {\n                next({\n                    clientId: params.clientId,\n                    hooks: {\n                        mediaDetails: function() {\n                            return {\n                                details: {\n                                    title: params.mediaTitle,\n                                    description: params.mediaDescription,\n                                },\n                                outcomes: {\n                                    isExpected: true\n                                }\n                            };\n                        },\n                        ssoAuthRequestHandle: function() {\n                            window.location.replace(params.loginUrl);\n                        },\n                        getPageUrl: function() {\n                            return window.location.href;\n                        },\n                    },\n                    group: {\n                        id: params.mediaGroupId,\n                        title: params.mediaGroupTitle,\n                        description: params.mediaGroupDescription,\n                    },\n                    ... (params.locale) && {locale: params.locale},\n                });\n            });\n\n            annoto.onReady(function(api) {\n                const token = params.userToken;\n                api.auth(token, function(err) {\n                    if (err) {\n                        log.error('AnnotoMoodle: SSO auth error', err);\n                    }\n                });\n            });\n        },\n\n        checkVimeoTime: function() {\n            const isVimeoTime = document.getElementById('page-mod-videotime-view');\n            const self = this;\n            let setupRetry = 0;\n\n            const isReady = function() {\n                let vimeoPlayer = document.querySelector('iframe[src*=\"vimeo.com\"]');\n                if (!vimeoPlayer && setupRetry < 50) {\n                    setupRetry++;\n                    setTimeout(isReady, 100);\n                } else {\n                    self.bootstrap();\n                }\n            };\n\n            if (isVimeoTime) {\n                isReady();\n            }\n        },\n\n        tilesInit: function() {\n            if (!document.body.classList.contains('format-tiles')) {\n                return;\n            }\n            const self = this;\n            const formatSelectors = {\n                tiles: 'body.format-tiles #multi_section_tiles li.section.main.moveablesection'\n            };\n\n            const reloadAnnoto = function(mutationList) {\n                let mutationTarget = null;\n\n                if (mutationList) {\n                    mutationTarget = mutationList.filter(function(m) {\n                        return m.attributeName === 'class' && m.target.classList.contains('state-visible');\n                    });\n                }\n\n                if (!mutationTarget.length) {\n                    if (self.annotoAPI && self.isloaded) {\n                        self.annotoAPI.destroy().then(self.isloaded = false);\n                    }\n                    return;\n                }\n                setTimeout(function() {\n                    const player = self.findPlayer(mutationTarget[0].target);\n\n                    if (player) {\n                        self.params.playerId = `#${player.id}`;\n                        if (self.bootsrapDone) {\n                            self.prepareConfig();\n                            self.annotoAPI.load(self.config).then(self.isloaded = true);\n                        } else {\n                            self.bootsrapDone = self.isloaded = true;\n                            require([self.params.bootstrapUrl], self.bootWidget.bind(self));\n                            log.info('AnnotoMoodle: detected ' + self.params.playerType + ':' + self.params.playerId);\n                        }\n                    }\n                }, 2000);\n            };\n\n            const observerNodeTargets = document.querySelectorAll(Object.values(formatSelectors).join(', '));\n\n            if (observerNodeTargets.length > 0) {\n                const observerConfig = {attributes: true, childList: false, subtree: false},\n                    observer = new MutationObserver(reloadAnnoto);\n\n                observerNodeTargets.forEach(function(target) {\n                    observer.observe(target, observerConfig);\n                });\n            }\n        },\n\n        icontent: function(){\n            if (!document.body.classList.contains('path-mod-icontent')) {\n                return;\n            }\n            const wrapper = document.getElementById('region-main');\n            const idIcontentPages = document.getElementById('idicontentpages');\n            const self = this;\n\n            const reloadAnnoto = function() {\n\n                if (self.annotoAPI && self.isloaded) {\n                    self.annotoAPI.destroy().then(self.isloaded = false);\n                }\n\n                setTimeout(function() {\n                    const player = self.findPlayer(idIcontentPages);\n\n                    if (player) {\n                        self.params.playerId = `#${player.id}`;\n                        if (self.bootsrapDone) {\n                            self.prepareConfig();\n                            self.annotoAPI.load(self.config).then(self.isloaded = true);\n                        } else {\n                            self.bootsrapDone = self.isloaded = true;\n                            require([self.params.bootstrapUrl], self.bootWidget.bind(self));\n                            log.info('AnnotoMoodle: detected ' + self.params.playerType + ':' + self.params.playerId);\n                        }\n                    }\n                }, 2000);\n            };\n\n            wrapper.addEventListener('click', function(event){\n                if (!event.target.matches('.load-page')) {\n                    return;\n                }\n                reloadAnnoto();\n            });\n        },\n\n        findMultiplePlayers: function() {\n            const self = this;\n            const vimeos = $('body').find('iframe[src*=\"vimeo.com\"]').get();\n            const videojs = $('body').find('.video-js').get();\n            const allPlayers = {\n                ... (vimeos.length > 1) && {'vimeo': [...vimeos]},\n                ... (videojs.length > 1) && {'videojs': [...videojs]},\n            };\n\n            let multiplePlayers = false;\n            let activePlayerId = null;\n\n            if (allPlayers.length) {\n                return multiplePlayers;\n            }\n            multiplePlayers = true;\n            log.info('AnnotoMoodle: setup multiple players');\n\n            const validatePlayerId = function(element){\n                if (!element.id || element.id === '') {\n                    element.id = 'annoto_player_id_' + Math.random().toString(36).substr(2, 6);\n                }\n                return element.id;\n            };\n\n            const reloadAnnotoWidget = function(element, playerType){\n                self.params.playerId = `#${element.id}`;\n                self.params.element = element;\n                self.params.playerType = playerType;\n                self.prepareConfig();\n\n                self.annotoAPI.destroy().then(function () {\n                    self.annotoAPI.load(self.config);\n                    log.info(`AnnotoMoodle: reload Player: ${element.id}`);\n                });\n            };\n\n            for (const [playerType, players] of Object.entries(allPlayers)) {\n                players.forEach((player) => {\n                    validatePlayerId(player);\n\n                    log.info(`AnnotoMoodle: setup Player: ${player.id}`);\n                    switch (playerType) {\n                        case 'vimeo':\n                            let vimeoPlayer = new VimeoPlayer(player);\n                            vimeoPlayer.on('play', function () {\n                                if (player.id === activePlayerId) {\n                                    return;\n                                }\n                                activePlayerId = player.id;\n                                log.info(`AnnotoMoodle: Player play: ${player.id}`);\n\n                                reloadAnnotoWidget(player, playerType);\n                            });\n                            break;\n                        case 'videojs':\n                            let playerJs = videoJsPlayer(player);\n                            playerJs.player().on('play', function() {\n                                if (player.id === activePlayerId) {\n                                    return;\n                                }\n                                activePlayerId = player.id;\n                                log.info(`AnnotoMoodle: Player play: ${player.id}`);\n\n                                reloadAnnotoWidget(player, playerType);\n                            });\n                            break;\n                    }\n                });\n            }\n\n            return multiplePlayers;\n        }\n\n    };\n});\n"],"file":"annoto.min.js"}