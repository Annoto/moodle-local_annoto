define(["jquery"],function(a){return{init:function(a){return this.params=a,a?this.params.isGlobalScope||this.params.isACLmatch||this.hasAnnotoTag()?this.findPlayer():void this.log("Annoto is disabled for this page."):void this.logWarn("Empty params. Annoto will not start.")},hasAnnotoTag:function(){return a("annoto").length>0&&0===a("annotodisable").length},findPlayer:function(){var b=a("iframe.h5p-iframe").first().get(0),c=a('iframe[src*="youtube.com"]').first().get(0),d=a('iframe[src*="vimeo.com"]').first().get(0),e=a("video").first().get(0);if(b)annotoplayer=b,this.params.playerType="h5p";else if(e)annotoplayer=e,this.params.playerType="videojs";else if(c){var f=c.src;f.search(/enablejsapi/i)===-1&&(c.src=f.search(/[?]/)===-1?f+"?enablejsapi=1":f+"&enablejsapi=1"),annotoplayer=c,this.params.playerType="youtube"}else{if(!d)return;annotoplayer=d,this.params.playerType="vimeo"}annotoplayer.id&&""!==annotoplayer.id||(annotoplayer.id=this.params.defaultPlayerId),this.params.playerId=annotoplayer.id,this.bootstrap()},bootstrap:function(){if(!this.bootsrapDone)return this.bootsrapDone=!0,require([this.params.bootstrapUrl],this.bootWidget.bind(this))},bootWidget:function(){var a=this.params,b=this,c=["youtube","vimeo"],d=["h5p"],e="element_edge";a.widgetOverlay&&"auto"!==a.widgetOverlay?"inner"===a.widgetOverlay&&(e="inner"):e=d.indexOf(a.playerType)!==-1?"inner":"element_edge";var f={clientId:a.clientId,position:a.position,features:{tabs:a.featureTab,cta:a.featureCTA},width:{max:"inner"===e?320:360},align:{vertical:a.alignVertical,horizontal:e},ux:{ssoAuthRequestHandle:function(){window.location.replace(a.loginUrl)}},zIndex:a.zIndex?a.zIndex:100,widgets:[{player:{type:a.playerType,element:a.playerId,mediaDetails:function(){return{title:a.mediaTitle,description:a.mediaDescription,group:{id:a.mediaGroupId,type:"playlist",title:a.mediaGroupTitle,privateThread:a.privateThread}}}},timeline:{overlayVideo:c.indexOf(a.playerType)===-1}}],demoMode:a.demoMode,rtl:a.rtl,locale:a.locale};window.Annoto?(window.Annoto.on("ready",function(c){var d=a.userToken;c&&d&&""!==d&&c.auth(d)["catch"](function(){b.logError("Annoto SSO auth error")})}),"videojs"===a.playerType&&window.requirejs?window.require(["media_videojs/video-lazy"],function(a){f.widgets[0].player.params={videojs:a},window.Annoto.boot(f)}):window.Annoto.boot(f)):b.logWarn("Annoto not loaded")},log:function(a,b){window.console&&console.debug("AnnotoFilterPlugin: "+a,b||"")},logWarn:function(a,b){window.console&&console.warn("AnnotoFilterPlugin: "+a,b||"")},logError:function(a,b){window.console&&console.error("AnnotoFilterPlugin: "+a,b||"")}}});